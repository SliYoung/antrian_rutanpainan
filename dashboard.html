<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Antrian | Rutan Kelas IIB Painan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/png" href="https://i.imgur.com/GifnqrQ.png">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  color: #334155;
  line-height: 1.6;
}
.header {
  background: linear-gradient(135deg, #1e40af, #3b82f6);
  color: #fff;
  padding: 20px 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: 10;
}
.brand {
  display: flex;
  align-items: center;
  gap: 15px;
}
.brand img {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}
.brand h1 {
  font-size: 20px;
  font-weight: 700;
  margin: 0;
}
.logout {
  background: linear-gradient(135deg, #dc2626, #ef4444);
  border: none;
  padding: 12px 20px;
  color: #fff;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: transform 0.2s, box-shadow 0.2s;
}
.logout:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
}
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 30px;
}
.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}
.stat {
  background: #fff;
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  text-align: center;
  transition: transform 0.2s;
}
.stat:hover {
  transform: translateY(-5px);
}
.stat h3 {
  margin: 0;
  color: #64748b;
  font-size: 16px;
  font-weight: 400;
}
.stat h1 {
  margin: 10px 0 0;
  font-size: 36px;
  color: #1e40af;
  font-weight: 700;
}
.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  background: #fff;
  padding: 20px;
  border-radius: 20px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}
.controls div {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
button {
  padding: 12px 18px;
  background: linear-gradient(135deg, #2563eb, #3b82f6);
  color: #fff;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: transform 0.2s, box-shadow 0.2s;
}
button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
}
button:disabled {
  background: #9ca3af;
  cursor: not-allowed;
}
#btnSound {
  background: linear-gradient(135deg, #059669, #10b981);
}
#btnSound:hover {
  box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
}
button:nth-child(2) {
  background: linear-gradient(135deg, #7c3aed, #8b5cf6);
}
button:nth-child(2):hover {
  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
}
button:nth-child(3) {
  background: linear-gradient(135deg, #f59e0b, #fbbf24);
}
button:nth-child(3):hover {
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}
button:nth-child(4) {
  background: linear-gradient(135deg, #ef4444, #f87171);
}
button:nth-child(4):hover {
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}
select {
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #d1d5db;
  background: #fff;
  font-size: 14px;
}
.card {
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
  padding: 30px;
  overflow-x: auto;
}
h2 {
  text-align: center;
  color: #1e40af;
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  padding: 15px;
  font-size: 14px;
  text-align: center;
  border-bottom: 1px solid #e2e8f0;
}
th {
  background: linear-gradient(135deg, #2563eb, #3b82f6);
  color: #fff;
  font-weight: 600;
}
.status-menunggu {
  color: #d97706;
  font-weight: 600;
}
.status-selesai {
  color: #6b7280;
  font-weight: 600;
}
td button {
  margin: 5px;
  font-size: 12px;
}
@media (max-width: 768px) {
  .header {
    flex-direction: column;
    gap: 15px;
  }
  .stats {
    grid-template-columns: 1fr;
  }
  .controls {
    flex-direction: column;
    align-items: stretch;
  }
  .controls div {
    justify-content: center;
  }
}
</style>
</head>
<body>
<script>
if(localStorage.getItem("login")!=="true"){
  location.href="login.html";
}
</script>
<!-- ðŸ”” AUDIO BEL -->
<audio id="audioBel" preload="auto">
  <source src="ringtone Hp bell bandara.mp3" type="audio/mpeg">
</audio>
<div class="header">
  <div class="brand">
    <img src="https://i.imgur.com/GifnqrQ.png" alt="Logo Rutan">
    <h1>Dashboard Antrian Rutan Kelas IIB Painan</h1>
  </div>
  <button class="logout" onclick="logout()">Logout</button>
</div>
<div class="container">
  <div class="stats">
    <div class="stat">
      <h3>Total Hari Ini</h3>
      <h1 id="total">0</h1>
    </div>
    <div class="stat">
      <h3>Menunggu</h3>
      <h1 id="menunggu">0</h1>
    </div>
    <div class="stat">
      <h3>Selesai</h3>
      <h1 id="selesaiCount">0</h1>
    </div>
  </div>
  <div class="controls">
    <div>
      <button id="btnSound" onclick="aktifkanSuara()">ðŸ”Š Aktifkan Suara</button>
      <button onclick="pengumumanPelayanan()">ðŸ“¢ Pengumuman Pelayanan</button>
      <button onclick="panggilAntrianBerikutnya()">ðŸ“£ Panggil Antrian Berikutnya</button>
      <button onclick="pengumumanSelesai()">ðŸ”” Pengumuman Selesai</button>
    </div>
    <select id="voiceType">
      <option value="female">Wanita</option>
      <option value="male">Pria</option>
    </select>
  </div>
  <div class="card">
    <h2>Data Antrian Kunjungan</h2>
    <table>
      <thead>
        <tr>
          <th>No</th>
          <th>Nama</th>
          <th>WBP</th>
          <th>Tanggal</th>
          <th>Antrian</th>
          <th>Status</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="dataAntrian"></tbody>
    </table>
  </div>
</div>
<script>
const API_URL="https://script.google.com/macros/s/AKfycbyCoGTPVM2RRzxTve3ik1PQRS78VHYif1-33Lcg8XEKbRdaxOW02JxGGQxmItnNbeE2/exec";
let voicesReady=false;
let VOICES=[];
speechSynthesis.onvoiceschanged=()=>{
  VOICES = speechSynthesis.getVoices();
};
// ðŸ”” BEL PEMBUKA + SAMBUTAN
function aktifkanSuara(){
  const bel=document.getElementById("audioBel");
  bel.currentTime=0;
  bel.play();
  setTimeout(()=>{
    bel.pause();
    bel.currentTime=0;
    const u=new SpeechSynthesisUtterance(
      "Selamat datang di Rumah Tahanan Negara Kelas IIB Painan. Layanan antrian akan segera dimulai. Silakan memperhatikan layar informasi."
    );
    u.lang="id-ID";
    u.rate=0.9;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
    voicesReady=true;
    btnSound.innerText="âœ… Suara Aktif";
    btnSound.disabled=true;
  },5000);
}
// ðŸ“¢ PENGUMUMAN PELAYANAN (BEL DI AWAL)
function pengumumanPelayanan(){
  if(!voicesReady){
    alert("Aktifkan suara terlebih dahulu");
    return;
  }
  const bel=document.getElementById("audioBel");
  let v=VOICES.find(v=>v.lang.includes("id"))||VOICES[0];
  bel.currentTime=0;
  bel.play();
  setTimeout(()=>{
    bel.pause();
    bel.currentTime=0;
    const msg=new SpeechSynthesisUtterance(
      "Mohon perhatian. Demi menjaga keamanan dan ketertiban di Rumah Tahanan Negara Kelas IIB Painan, seluruh pengunjung dilarang membawa senjata tajam, narkotika, alat komunikasi, rokok, uang tunai, minuman keras, serta barang berbahaya lainnya. Mohon patuhi seluruh ketentuan yang berlaku. Terima kasih."
    );
    msg.lang="id-ID";
    msg.rate=0.85;
    msg.voice=v;
    speechSynthesis.cancel();
    speechSynthesis.speak(msg);
  },5000);
}
// ðŸ“£ PANGGIL ANTRIAN BERIKUTNYA
function panggilAntrianBerikutnya(){
  if(!voicesReady){
    alert("Aktifkan suara terlebih dahulu");
    return;
  }
  fetch(API_URL).then(r=>r.json()).then(data=>{
    const nextAntrian = data.find(x => x.status === "Menunggu");
    if(nextAntrian){
      suara(nextAntrian.antrian);
    } else {
      alert("Tidak ada antrian menunggu.");
    }
  });
}
// ðŸ”” PENGUMUMAN SELESAI
function pengumumanSelesai(){
  if(!voicesReady){
    alert("Aktifkan suara terlebih dahulu");
    return;
  }
  const bel=document.getElementById("audioBel");
  let v=VOICES.find(v=>v.lang.includes("id"))||VOICES[0];
  bel.currentTime=0;
  bel.play();
  setTimeout(()=>{
    bel.pause();
    bel.currentTime=0;
    const msg=new SpeechSynthesisUtterance(
      "Layanan antrian hari ini telah selesai. Terima kasih atas kunjungan Anda ke Rumah Tahanan Negara Kelas IIB Painan. Silakan kembali ke rumah dengan aman."
    );
    msg.lang="id-ID";
    msg.rate=0.85;
    msg.voice=v;
    speechSynthesis.cancel();
    speechSynthesis.speak(msg);
  },5000);
}
// ðŸ“£ PANGGIL ANTRIAN (BEL DI AKHIR + DURASI)
function suara(antrian){
  if(!voicesReady){
    alert("Aktifkan suara terlebih dahulu");
    return;
  }
  const bel=document.getElementById("audioBel");
  let v=VOICES.find(v=>v.lang.includes("id"))||VOICES[0];
  const msg=new SpeechSynthesisUtterance(
    `Nomor antrian ${antrian}, silakan menuju ke ruang pelayanan PTSP`
  );
  msg.lang="id-ID";
  msg.rate=0.85;
  msg.pitch=voiceType.value==="male"?0.8:1.2;
  msg.voice=v;
  msg.onend=()=>{
    bel.currentTime=0;
    bel.play();
    setTimeout(()=>{
      bel.pause();
      bel.currentTime=0;
    },5000);
  };
  speechSynthesis.cancel();
  speechSynthesis.speak(msg);
}
function loadData(){
  fetch(API_URL).then(r=>r.json()).then(data=>{
    let t=0,m=0,s=0;
    dataAntrian.innerHTML="";
    data.forEach((x,i)=>{
      t++; if(x.status==="Menunggu") m++; if(x.status==="Selesai") s++;
      dataAntrian.innerHTML+=`
<tr>
<td>${i+1}</td>
<td>${x.nama}</td>
<td>${x.wbp}</td>
<td>${x.tanggal}</td>
<td><b>${x.antrian}</b></td>
<td class="status-${x.status.toLowerCase()}">${x.status}</td>
<td>
${x.status!=="Selesai"?`
<button onclick="suara('${x.antrian}')" style="background:#059669">ðŸ”Š Panggil</button><br><br>
<button onclick="selesai(${x.id})" style="background:#6b7280">âœ… Selesai</button>
`:``
}
</td>
</tr>`;
    });
    total.innerText=t;
    menunggu.innerText=m;
    selesaiCount.innerText=s;
  });
}
function selesai(row){
  fetch(API_URL,{method:"POST",body:JSON.stringify({action:"selesai",row})})
  .then(()=>loadData());
}
function logout(){
  localStorage.removeItem("login");
  location.href="login.html";
}
loadData();
setInterval(loadData,5000);
</script>
</body>
</html>